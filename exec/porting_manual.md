# ÏÇ∞Ï∂úÎ¨º

### I. Í∏∞Ïà† Ïä§ÌÉù & Í∞úÎ∞ú ÌôòÍ≤Ω

---

> [ÏÇ¨Ïö© ÎèÑÍµ¨]
>
> - Ïù¥Ïäà Í¥ÄÎ¶¨: JIRA
> - ÌòïÏÉÅ Í¥ÄÎ¶¨: GitLab
> - Ïª§ÎÆ§ÎãàÏºÄÏù¥ÏÖò: Mattermost, Notion, Google Docs
> - ÎîîÏûêÏù∏: Figma
> - UCC: Movavi
> - CI/CD: EC2, Docker, Jenkins

> [Í∞úÎ∞ú ÌôòÍ≤Ω]
>
> - **Front-end**
>   - React: 19.0.0
>   - Next.js: 15.1.7
>   - Typescript: 2.0.4
>   - ESLint: 3
>   - Prettier: 3.5.1
>   - DaisyUI: 4.12.23
>   - PWA: 1.9.7
> - **Back-end**
>   - JDK: 17.0.3 (openjdk)
>   - SpringBoot: 3.4.1
>   - SpringSecurity
>   - Gradle: 8.11
>   - jjwt-api:0.12.3
>   - Swagger: 2.3.0
> - **DB**
>   - MySQL: 8.0.41
> - **Infra**
>   - Server:
>     - AWS EC2: Ubuntu 22.04.5 LTS
>   - Containerization Platform:
>     - Docker: 27.5.1
>   - CI/CD:
>     - Jenkins: 2.495
>   - Web Server:
>     - Nginx: 1.18.0 (Ubuntu)

> [Ïô∏Î∂Ä ÏÑúÎπÑÏä§]
>
> - OpenVidu
> - RabbitMQ
> - Redis
> - Kakao OAuth
> - CLOVA Speech API

> [gitignore]

```
[Front]

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*
.env-fe

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

```

```
[Back]

HELP.md
.gradle
build/
!gradle/wrapper/gradle-wrapper.jar
!**/src/main/**/build/
!**/src/test/**/build/

### STS ###
.apt_generated
.classpath
.factorypath
.project
.settings
.springBeans
.sts4-cache
bin/
!**/src/main/**/bin/
!**/src/test/**/bin/

### IntelliJ IDEA ###
.idea
*.iws
*.iml
*.ipr
out/
!**/src/main/**/out/
!**/src/test/**/out/

### NetBeans ###
/nbproject/private/
/nbbuild/
/dist/
/nbdist/
/.nb-gradle/

### VS Code ###
.vscode/

### .env ###
*.env*

### .yml ###
!example.yml

# QueryDSL
/src/main/generated/

### ÌÇ§ ÌååÏùº
**/keystore/**
```

> [ÌôòÍ≤ΩÎ≥ÄÏàò]

```
[Front]
# jenkinsÏóê .env-fe ÌååÏùºÎ°ú Ï†ïÏùò

HOSTNAME=
PORT=

# Kakao OAuth ÏÑ§Ï†ï
NEXT_PUBLIC_KAKAO_JAVASCRIPT_KEY=
NEXT_PUBLIC_KAKAO_CLIENT_ID=
NEXT_PUBLIC_KAKAO_REDIRECT_URI=
NEXT_PUBLIC_BACKEND_URL=

# Clova API KEY
CLOVA_API_KEY=
CLOVA_API_URL=
```

```
[Back]
# ÏÑúÎ≤Ñ ÏÑ§Ï†ï
SERVER_PORT={Î∞±ÏóîÎìú ÏÑúÎ≤ÑÏö© Ìè¨Ìä∏}

# DB ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÏÑ§Ï†ï
DB_URL=jdbc:mariadb://{ÎèÑÎ©îÏù∏}:{DBÏö© Ìè¨Ìä∏}/{DB Ïù¥Î¶Ñ}
DB_USERNAME={DB ÏïÑÏù¥Îîî}
DB_PASSWORD={DB Ìå®Ïä§ÏõåÎìú}

# MQTT Ïó∞Í≤∞ ÏÑ§Ï†ï
MQTT_BROKER_URL=tcp://{ÎèÑÎ©îÏù∏}:{MQTTÏö© Ìè¨Ìä∏}

# DB Ïó∞Í≤∞ ÏÑ§Ï†ï
MYSQL_ENDPOINT=
MYSQL_ROOT_PASSWORD=
MYSQL_DATABASE=
MYSQL_USER=
MYSQL_PASSWORD=

# JWT ÏÑ§Ï†ï
JWT_SECRET=
JWT_ACCESS_EXPIRATION=
JWT_REFRESH_EXPIRATION=

# Î°úÍ∑∏Ïù∏ redirect URL
FRONTEND_LOGIN_URL=

# Kakao OAuth ÏÑ§Ï†ï
KAKAO_CLIENT_ID=
KAKAO_CLIENT_SECRET=
KAKAO_REDIRECT_URI=

# S3 ÏÑ§Ï†ï
S3_ACCESS_KEY=
S3_SECRET_KEY=
S3_REGION=
S3_BUCKET_NAME=

# SSL ÏÑ§Ï†ï
SSL_KEYSTORE_PASSWORD=

# Openvidu ÏÑ§Ï†ï
OPENVIDU_LOCAL_URL=
OPENVIDU_PROD_URL=
OPENVIDU_SECRET=

# RabbitMQ ÏÑ§Ï†ï
RABBITMQ_USERNAME=
RABBITMQ_PASSWORD=
```

### II. ÎπåÎìú Î∞è Î∞∞Ìè¨

---

> [Í∞úÎ∞ú ÌôòÍ≤ΩÏóêÏÑú ÏßÅÏ†ë ÎπåÎìú(Î°úÏª¨ ÎπåÎìú)] > [Front]
>
> 1. ÏùòÏ°¥ÏÑ± ÏÑ§Ïπò `npm install`
> 2. ÌîÑÎ°úÏ†ùÌä∏ ÎπåÎìú (Ï†ïÏ†Å ÌååÏùº ÏÉùÏÑ±) `npm run build`
>
> [Back]
>
> 1. ÌîÑÎ°úÏ†ùÌä∏ ÎπåÎìú `./gradlew build` (Gradle - Tasks - build - bootJar Î°úÎèÑ jar
>    ÌååÏùº ÏÉùÏÑ± Í∞ÄÎä•)
> 2. ÎπåÎìúÎêú JAR ÌååÏùº Ïã§Ìñâ `java -jar build/libs/{ÌîÑÎ°úÏ†ùÌä∏Î™Ö}.jar`
>
> - ÎπåÎìú/Ïã§Ìñâ ÎèôÏãúÏóê ÌïòÎäî Í≤ΩÏö∞ `./gradlew bootRun`

> [Î∞∞Ìè¨ Ïãú ÎπåÎìú(Jenkins ÌååÏù¥ÌîÑÎùºÏù∏)]

> jenkins ÌååÏù¥ÌîÑÎùºÏù∏ - Front

```
pipeline {
    agent any

    environment {
        REPO_URL = 'https://lab.ssafy.com/s12-webmobile1-sub1/S12P11A801.git'
        BRANCH_NAME = 'client'
        CREDENTIALS_ID = 'gitlab-token'
        IMAGE_NAME = "nextjs-app"
        CONTAINER_NAME = "nextjs_app"
        DOCKER_COMPOSE_FILE = "docker-compose-fe.yml"
        ENV_CREDENTIALS_ID = "nextjs_env_file"
    }

    stages {
        stage('Checkout') {
            steps {
                echo "üîç ${BRANCH_NAME} Î∏åÎûúÏπò Ï≤¥ÌÅ¨ÏïÑÏõÉ Ï§ë..."
                git branch: BRANCH_NAME, credentialsId: CREDENTIALS_ID, url: REPO_URL
            }
        }

        stage('Retrieve .env-fe') {
            steps {
                echo "üìÇ Jenkins CredentialsÏóêÏÑú .env-fe Í∞ÄÏ†∏Ïò§Îäî Ï§ë..."
                withCredentials([file(credentialsId: ENV_CREDENTIALS_ID, variable: 'ENV_FILE')]) {
                    sh "chmod 664 .env-fe"
                    sh "cp $ENV_FILE .env-fe"
                }
            }
        }

        stage('Stop & Remove Existing Containers') {
            steps {
                echo "üõë Í∏∞Ï°¥ Docker Ïª®ÌÖåÏù¥ÎÑà Ï†ïÎ¶¨ Ï§ë..."
                script {
                    def containerExists = sh(script: "docker ps -a -q -f name=${CONTAINER_NAME}", returnStdout: true).trim()
                    if (containerExists) {
                        echo "Removing existing container..."
                        sh "docker stop ${CONTAINER_NAME} || true"
                        sh "docker rm ${CONTAINER_NAME} || true"
                    } else {
                        echo "No existing container found."
                    }
                }
            }
        }

        stage('Build & Deploy with Docker Compose') {
            steps {
                echo "üöÄ Docker ComposeÎ•º Ïù¥Ïö©Ìïú ÎπåÎìú Î∞è Î∞∞Ìè¨..."
                sh "docker-compose -f ${DOCKER_COMPOSE_FILE} up -d --build"
            }
        }
    }

    post {
        success {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'good',
                message: "ÎπåÎìú ÏÑ±Í≥µ: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n(<${env.BUILD_URL}|Details>)",
                endpoint: 'https://meeting.ssafy.com/hooks/g54hbziitjyxpfuwcijqsxmzhy',
                channel: 'a801_private'
                )
            }
        }
        failure {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'danger',
                message: "ÎπåÎìú Ïã§Ìå®: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n(<${env.BUILD_URL}|Details>)",
                endpoint: 'https://meeting.ssafy.com/hooks/g54hbziitjyxpfuwcijqsxmzhy',
                channel: 'a801_private'
                )
            }
        }
    }
}
```

> jenkins ÌååÏù¥ÌîÑÎùºÏù∏ - Backend

```
pipeline {
    agent any
    environment {
        ENV_FILE_PATH = "${WORKSPACE}/.env"
        KEYSTORE_FILE_PATH = "${WORKSPACE}/keystore/ssafy-web.p12"  // Î∞∞Ìè¨ Ïãú ÏÇ¨Ïö©Îê† ÌÇ§Ïä§ÌÜ†Ïñ¥ Í≤ΩÎ°ú
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'server',
                    url: 'https://lab.ssafy.com/s12-webmobile1-sub1/S12P11A801.git',
                    credentialsId: 'gitlab-token'
            }
        }

        stage('Retrieve .env from Credentials') {
            steps {
                withCredentials([file(credentialsId: 'env-file', variable: 'ENV_FILE')]) {
                    sh 'chmod 664 $ENV_FILE_PATH'
                    sh 'cp $ENV_FILE $ENV_FILE_PATH'
                }
            }
        }

        stage('Docker Compose Down') {
            steps {
                sh 'docker-compose down || true'
            }
        }

        stage('Docker Compose Build & Up') {
            steps {
                sh '''
                export $(cat .env | xargs)
                docker-compose up -d --build
                '''
            }
        }

    }
    post {
        success {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'good',
                message: "ÎπåÎìú ÏÑ±Í≥µ: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n(<${env.BUILD_URL}|Details>)",
                endpoint: 'https://meeting.ssafy.com/hooks/g54hbziitjyxpfuwcijqsxmzhy',
                channel: 'a801_private'
                )
            }
        }
        failure {
        	script {
                def Author_ID = sh(script: "git show -s --pretty=%an", returnStdout: true).trim()
                def Author_Name = sh(script: "git show -s --pretty=%ae", returnStdout: true).trim()
                mattermostSend (color: 'danger',
                message: "ÎπåÎìú Ïã§Ìå®: ${env.JOB_NAME} #${env.BUILD_NUMBER} by ${Author_ID}(${Author_Name})\n(<${env.BUILD_URL}|Details>)",
                endpoint: 'https://meeting.ssafy.com/hooks/g54hbziitjyxpfuwcijqsxmzhy',
                channel: 'a801_private'
                )
            }
        }
    }
}

```

> Frontend Dockerfile

```
# Stage 1: Build the application
FROM node:18-alpine AS builder

WORKDIR /app

# Install dependencies
COPY package.json package-lock.json ./
RUN npm install

# Copy application code
COPY . .

# ÌôòÍ≤Ω Î≥ÄÏàò ÌååÏùº ÏÑ§Ï†ï
ENV DOTENV_CONFIG_PATH=/app/.env-fe

# Build the application, ESLint Í≤ÄÏÇ¨ ÏÉùÎûµ
RUN NEXT_PUBLIC_DISABLE_ESLINT=true npm run build

# Stage 2: Create a lightweight production image
FROM node:18-alpine

WORKDIR /app

# Copy built application from builder stage
COPY --from=builder /app ./

# Expose port 3000
EXPOSE 3000

# Run the Next.js application
CMD ["npm", "run", "start"]

```

> Frontend Docker compose

```
version: '3.8'

services:
  nextjs:
    container_name: nextjs_app
    build:
      context: .
      dockerfile: Dockerfile-fe
    ports:
      - "3000:3000"
    env_file:
      - .env-fe
    restart: always

```

> Backend Dockerfile

```
# ----------------------------
# 1Îã®Í≥Ñ: ÎπåÎìú Ïä§ÌÖåÏù¥ÏßÄ
# ----------------------------
FROM gradle:7.6.1-jdk17 AS builder

# ÏûëÏóÖ ÎîîÎ†âÌÜ†Î¶¨
WORKDIR /app

# (1) Gradle Í¥ÄÎ†® Ï£ºÏöî ÌååÏùºÎßå Î®ºÏ†Ä Î≥µÏÇ¨ (ÏùòÏ°¥ÏÑ± Ï∫êÏãú ÌôúÏö© Î™©Ï†Å)
COPY dubdub/build.gradle dubdub/settings.gradle dubdub/gradlew ./
COPY dubdub/gradle ./gradle

# gradlew Ïã§Ìñâ Í∂åÌïú (Î¶¨ÎàÖÏä§ ÌôòÍ≤ΩÏóêÏÑú ÌïÑÏöî)
RUN chmod +x gradlew

# Ï¥àÍ∏∞ ÎπåÎìú (ÏùòÏ°¥ÏÑ± Îã§Ïö¥Î°úÎìú; Ïã§Ìå®Ìï¥ÎèÑ Ï∫êÏãú Ìö®Í≥ºÎ•º ÏúÑÌï¥ || true ÏÇ¨Ïö©)
RUN ./gradlew build -x test --no-daemon || true

# (2) ÎÇòÎ®∏ÏßÄ ÏÜåÏä§ Î≥µÏÇ¨
COPY dubdub/ ./

RUN chmod +x gradlew

# (3) ÏµúÏ¢Ö ÎπåÎìú
RUN ./gradlew clean build -x test --no-daemon

# ----------------------------
# 2Îã®Í≥Ñ: Îü∞ÌÉÄÏûÑ Ïä§ÌÖåÏù¥ÏßÄ
# ----------------------------
FROM eclipse-temurin:17-jre-alpine

# TimeZone ÏÑ§Ï†ï
ENV TZ=Asia/Seoul
RUN apk --no-cache add tzdata

WORKDIR /app

# ÎπåÎìú ÏÇ∞Ï∂úÎ¨º(JAR) Î≥µÏÇ¨
COPY --from=builder /app/build/libs/*.jar /app/dubdub_app.jar

# Ïª®ÌÖåÏù¥ÎÑàÏóêÏÑú Ïó¥ Ìè¨Ìä∏ (Ïòà: 8080)
EXPOSE 8080

# Ïª®ÌÖåÏù¥ÎÑà Ïã§Ìñâ Ïãú Î™ÖÎ†π
ENTRYPOINT ["java", "-jar", "/app/dubdub_app.jar"]

```

> Backend Docker compose

```
version: '3.8'
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: dubdub_app
    ports:
      - "8081:8081"
    volumes:
      - ./logs:/app/logs
      - /home/ubuntu/jenkins-data/workspace/server-branch-deploy/keystore:/app/keystore
    env_file:
      - .env   # JenkinsÏóêÏÑú Î≥µÏÇ¨Îêú .env ÌååÏùºÏùÑ ÏûêÎèô Î°úÎìú
    environment:
      SPRING_PROFILES_ACTIVE: prod  # Î∞∞Ìè¨ ÌôòÍ≤Ω Ï†ÅÏö©
      REDIS_HOST: redis  # Redis Ïª®ÌÖåÏù¥ÎÑàÏùò Ïù¥Î¶Ñ
      REDIS_PORT: 6379
      RABBITMQ_HOST: rabbitmq
      RABBITMQ_PORT: 5672
      RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
      RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}
    depends_on:
      - redis  # Redis Ïª®ÌÖåÏù¥ÎÑàÍ∞Ä Î®ºÏ†Ä Ïã§ÌñâÎê®
      - rabbitmq

  redis:
    image: redis:7-alpine
    container_name: dubdub_redis
    ports:
      - "6379:6379"  # Ìò∏Ïä§Ìä∏ÏôÄ ÎèôÏùºÌïú Ìè¨Ìä∏ Îß§Ìïë
    command: redis-server --appendonly yes  # ÏòÅÏÜçÏÑ± ÌôúÏÑ±Ìôî
    volumes:
      - redis_data:/data  # Redis Îç∞Ïù¥ÌÑ∞ ÏòÅÏÜçÌôî
    restart: always

  rabbitmq:
    image: rabbitmq:3.13-management
    container_name: dubdub_rabbitmq
    ports:
      - "5672:5672"    # AMQP ÌîÑÎ°úÌÜ†ÏΩúÏö©
      - "15672:15672"  # Í¥ÄÎ¶¨ UIÏö©
      - "15674:15674"  # STOMP ÏõπÏÜåÏºìÏö©
    command: >
      bash -c "rabbitmq-plugins enable rabbitmq_management rabbitmq_web_stomp &&
              rabbitmq-server"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    environment:
      - RABBITMQ_DEFAULT_USER=${RABBITMQ_USERNAME}
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASSWORD}
    restart: always

volumes:
  redis_data:  # Redis Îç∞Ïù¥ÌÑ∞Î•º Ï†ÄÏû•ÌïòÎäî Î≥ºÎ•®
  rabbitmq_data:

```

> [Nginx ÏÑ§Ï†ïÌååÏùº]

```
# HTTPS ÏÑúÎ≤Ñ ÏÑ§Ï†ï
server {
    # NextJS Ïï±ÏúºÎ°ú ÎùºÏö∞ÌåÖ
    location / {
		    client_max_body_size 500M;
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /next-api/ {
		    client_max_body_size 500M;    # ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏöîÏ≤≠ Ïö©Îüâ Ï†úÌïúÏùÑ 500MBÎ°ú ÏÑ§Ï†ï
		    proxy_pass http://localhost:3000;
		    proxy_set_header Host $host;
		    proxy_set_header X-Real-IP $remote_addr;
		    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		}

    # Spring Boot Ïï±ÏúºÎ°ú ÎùºÏö∞ÌåÖ
    location /api {
		    client_max_body_size 500M; #ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï†ÑÏÜ° Ïö©Îüâ Î≥ÄÍ≤Ω
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # WebSocket ÏÑ§Ï†ï
    location /api/ws-studio {
		    proxy_pass http://localhost:8081/ws-studio;
		    proxy_http_version 1.1;
		    proxy_set_header Upgrade $http_upgrade;
		    proxy_set_header Connection "upgrade";
		    proxy_set_header Host $host;
		}

		# RabbitMQ Management UI
    location /rabbitmq/ {
        proxy_pass http://localhost:15672/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # SSL ÏÑ§Ï†ï
    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/i12a801.p.ssafy.io/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/i12a801.p.ssafy.io/privkey.pem;
    server_name i12a801.p.ssafy.io;
}

# HTTPÎ•º HTTPSÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏
server {
    if ($host = i12a801.p.ssafy.io) {
        return 301 https://$host$request_uri;
    }
    listen 80;
    server_name i12a801.p.ssafy.io;
    return 404;
}
```
